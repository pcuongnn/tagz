(function(){$(document).ready(function(){return window.productTemplate=Handlebars.compile($("#product_template").text()),$("#taxon_products").sortable({handle:".js-sort-handle"}),$("#taxon_products").on("sortstop",function(t,e){return $.ajax({url:Spree.routes.classifications_api,method:"PUT",dataType:"json",data:{token:Spree.api_key,product_id:e.item.data("product-id"),taxon_id:$("#taxon_id").val(),position:e.item.index()}})}),$("#taxon_id").length>0&&$("#taxon_id").select2({dropdownCssClass:"taxon_select_box",placeholder:Spree.translations.find_a_taxon,ajax:{url:Spree.routes.taxons_search,datatype:"json",data:function(t,e){return{per_page:50,page:e,without_children:!0,token:Spree.api_key,q:{name_cont:t}}},results:function(t,e){var a;return a=e<t.pages,{results:t.taxons,more:a}}},formatResult:function(t){return t.pretty_name},formatSelection:function(t){return t.pretty_name}}),$("#taxon_id").on("change",function(t){var e;return e=$("#taxon_products"),$.ajax({url:Spree.routes.taxon_products_api,data:{id:t.val,token:Spree.api_key},success:function(t){var a,r,o,n,s;if(e.empty(),0===t.products.length)return $("#taxon_products").html("<div class='alert alert-info'>"+Spree.translations.no_results+"</div>");for(n=t.products,s=[],a=0,r=n.length;r>a;a++)o=n[a],void 0!==o.master.images[0]&&void 0!==o.master.images[0].small_url&&(o.image=o.master.images[0].small_url),s.push(e.append(productTemplate({product:o})));return s}})}),$("#taxon_products").on("click",".js-delete-product",function(t){var e,a,r,o,n,s;return e=$("#taxon_id").val(),a=$(this).parents(".product"),r=a.data("product-id"),n=String(a.data("taxons")).split(",").map(Number),o=n.indexOf(parseFloat(e)),n.splice(o,1),s=n.length>0?n:[""],$.ajax({url:Spree.routes.products_api+"/"+r,data:{product:{taxon_ids:s},token:Spree.api_key},type:"PUT",success:function(t){return a.fadeOut(400,function(t){return a.remove()})}})}),$("#taxon_products").on("click",".js-edit-product",function(t){var e,a;return e=$(this).parents(".product"),a=e.data("product-id"),window.location=Spree.routes.edit_product(a)}),$(".variant_autocomplete").variantAutocomplete()})}).call(this);